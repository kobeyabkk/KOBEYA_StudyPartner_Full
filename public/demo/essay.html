<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小論文コーチングデモ - KOBEYA Study Partner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .step-dot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
            flex-direction: column;
            font-size: 0.75rem;
        }
        .step-dot-number {
            font-size: 1.25rem;
            font-weight: bold;
        }
        .step-dot.completed {
            background: #10b981;
            color: white;
        }
        .step-dot.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }
        .step-dot.pending {
            background: #e5e7eb;
            color: #9ca3af;
        }
        .step-line {
            flex: 1;
            height: 4px;
            background: #e5e7eb;
            margin: 0 0.5rem;
        }
        .step-line.completed {
            background: #10b981;
        }
        .tech-panel {
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        .code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        textarea {
            resize: vertical;
        }
        .reading-content {
            line-height: 2;
            font-size: 1.1rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-green-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/demo/index.html" class="hover:opacity-80">
                        <i class="fas fa-arrow-left mr-2"></i>デモトップに戻る
                    </a>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="/demo/eiken.html" class="hover:opacity-80">英検デモ</a>
                    <a href="/demo/essay.html" class="font-semibold border-b-2 border-white">小論文デモ</a>
                    <a href="https://github.com/kobeyabkk/KOBEYA_StudyPartner_Full" target="_blank" class="hover:opacity-80">
                        <i class="fab fa-github"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Left: Demo Area (2/3) -->
            <div class="lg:col-span-2">
                <!-- Title & Info -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="bg-green-100 p-3 rounded-lg">
                            <i class="fas fa-pen-fancy text-2xl text-green-600"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">小論文コーチング - 総合学習コース</h1>
                            <p class="text-sm text-gray-500">導入 → 語彙 → 短文 → 本練習 → チャレンジ → まとめ</p>
                        </div>
                    </div>
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>デモ版:</strong> 6ステップの完全な流れを体験できます。<br>
                            <strong>注意:</strong> 本番システムでは、各ステップでAIが個別に添削した解答が表示されます。
                        </p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="font-semibold mb-4 text-gray-700">学習進捗</h3>
                    <div class="flex items-center justify-between flex-wrap gap-2" id="progressBar">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Step Content Area -->
                <div id="stepArea" class="bg-white rounded-xl shadow-lg p-8 mb-6 fade-in">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Feedback Area -->
                <div id="feedbackArea" class="hidden bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl shadow-lg p-8 mb-6 fade-in">
                    <h3 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-robot text-blue-600 mr-3"></i>
                        AIフィードバック
                    </h3>
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 mb-4 text-sm">
                        <i class="fas fa-info-circle text-purple-600 mr-2"></i>
                        <strong>注意:</strong> 本番システムでは、AIがあなたの解答を分析して個別に添削したフィードバックが表示されます。
                    </div>
                    <div id="feedbackContent" class="text-gray-700"></div>
                </div>

                <!-- Navigation Buttons -->
                <div id="navigationArea" class="flex gap-4">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Right: Technical Explanation (1/3) -->
            <div class="lg:col-span-1">
                <div class="tech-panel bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-cogs text-green-600 mr-2"></i>技術解説
                    </h2>

                    <!-- 6ステップ構成 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-stairs text-purple-600 mr-2"></i>
                            6ステップ構成
                        </h3>
                        <div class="text-sm text-gray-600 space-y-2">
                            <div class="bg-green-50 p-3 rounded border-l-4 border-green-500">
                                <strong>Step 1: 導入</strong>
                                <p class="text-xs mt-1">テーマの読み物を提示<br>読解の確認</p>
                            </div>
                            <div class="bg-blue-50 p-3 rounded border-l-4 border-blue-500">
                                <strong>Step 2: 語彙</strong>
                                <p class="text-xs mt-1">5-10問の語彙問題<br>言い換え練習</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded border-l-4 border-purple-500">
                                <strong>Step 3: 短文</strong>
                                <p class="text-xs mt-1">短文作成（50-100字）<br>表現力を養う</p>
                            </div>
                            <div class="bg-orange-50 p-3 rounded border-l-4 border-orange-500">
                                <strong>Step 4: 本練習</strong>
                                <p class="text-xs mt-1">本番の小論文執筆<br>300-400字</p>
                            </div>
                            <div class="bg-red-50 p-3 rounded border-l-4 border-red-500">
                                <strong>Step 5: チャレンジ</strong>
                                <p class="text-xs mt-1">難易度の高い課題<br>応用力を試す</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded border-l-4 border-gray-500">
                                <strong>Step 6: まとめ</strong>
                                <p class="text-xs mt-1">振り返りと総評<br>学習の定着</p>
                            </div>
                        </div>
                    </div>

                    <!-- 画像解析機能 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-camera text-blue-600 mr-2"></i>
                            画像解析機能
                        </h3>
                        <div class="text-sm text-gray-600">
                            <p class="mb-2">GPT-4o Visionによる高精度解析：</p>
                            <ul class="space-y-1 text-xs">
                                <li><i class="fas fa-check text-green-600 mr-2"></i>手書き原稿のOCR</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>教科書・参考書の読み取り</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>日本語対応率 95%以上</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>平均処理時間 3-5秒</li>
                            </ul>
                        </div>
                    </div>

                    <!-- AIフィードバック生成 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-comments text-orange-600 mr-2"></i>
                            AIフィードバック
                        </h3>
                        <div class="code-block text-xs">
<pre>// 評価の4観点
{
  content: "内容の妥当性",
  grammar: "文法の正確性",
  vocabulary: "語彙の適切性",
  structure: "構成の明確性"
}

// 個別最適化
- 学生のレベルに応じた指導
- ポジティブな声かけ
- 具体的な改善提案
- 次のステップへの導き</pre>
                        </div>
                    </div>

                    <!-- セッション管理 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-database text-green-600 mr-2"></i>
                            セッション管理
                        </h3>
                        <div class="text-sm text-gray-600">
                            <p class="mb-2">途中から再開可能：</p>
                            <ul class="space-y-1 text-xs">
                                <li><i class="fas fa-check text-green-600 mr-2"></i>現在のステップを保存</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>解答履歴を記録</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>ページリロードで復元</li>
                                <li><i class="fas fa-check text-green-600 mr-2"></i>完了状態を識別</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 使用技術 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-layer-group text-purple-600 mr-2"></i>
                            使用技術
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                <span>GPT-4o Vision</span>
                                <span class="text-xs text-gray-500">画像解析</span>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                <span>GPT-4o</span>
                                <span class="text-xs text-gray-500">FB生成</span>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                <span>Cloudflare D1</span>
                                <span class="text-xs text-gray-500">セッション</span>
                            </div>
                            <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                <span>Hono.js</span>
                                <span class="text-xs text-gray-500">Backend</span>
                            </div>
                        </div>
                    </div>

                    <!-- パフォーマンス指標 -->
                    <div>
                        <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center">
                            <i class="fas fa-chart-line text-red-600 mr-2"></i>
                            パフォーマンス
                        </h3>
                        <div class="grid grid-cols-2 gap-3 text-center">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-2xl font-bold text-blue-600">2-3s</div>
                                <div class="text-xs text-gray-600">FB応答</div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-2xl font-bold text-green-600">95%</div>
                                <div class="text-xs text-gray-600">OCR精度</div>
                            </div>
                            <div class="bg-purple-50 p-3 rounded">
                                <div class="text-2xl font-bold text-purple-600">6</div>
                                <div class="text-xs text-gray-600">ステップ</div>
                            </div>
                            <div class="bg-orange-50 p-3 rounded">
                                <div class="text-2xl font-bold text-orange-600">100%</div>
                                <div class="text-xs text-gray-600">復元率</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo data - 実際のシステムに合わせた6ステップ
        const DEMO_THEME = {
            title: "環境問題について考えよう",
            content: `近年、地球温暖化や海洋プラスチック問題など、環境問題が深刻化しています。

私たちの身の回りでも、暑い日が増えたり、異常気象が起きたりと、その影響を感じることが多くなってきました。

環境を守るために、私たち一人ひとりができることは何でしょうか。ゴミの分別、節電、エコバッグの使用など、小さなことから始めることができます。

また、環境問題について学び、周りの人に伝えることも大切です。みんなで協力すれば、きっと地球を守ることができるはずです。`
        };

        const DEMO_STEPS = [
            {
                stepNumber: 1,
                type: 'introduction',
                title: 'Step 1: 導入',
                subtitle: '読み物を読んで理解する',
                question: '以下の読み物をよく読んで、「読んだ」ボタンを押してください。',
                content: DEMO_THEME.content,
                showReading: true,
                feedback: `📖 読み物の確認ができました！

【内容の確認】
この読み物のテーマは「環境問題」です。
主なポイント：
• 地球温暖化や海洋プラスチック問題
• 身の回りで感じる環境の変化
• 私たちにできること（ゴミ分別、節電、エコバッグ）
• 学んで周りに伝えることの大切さ

それでは次のステップで、この内容に関する語彙を学習していきましょう！`
            },
            {
                stepNumber: 2,
                type: 'vocabulary',
                title: 'Step 2: 語彙',
                subtitle: '言い換え練習',
                question: '以下の言葉を、より適切な表現に言い換えてください。（各1つずつ選んで答えてください）',
                vocabList: [
                    { original: '「すごく深刻」', answer: '「極めて深刻」' },
                    { original: '「いっぱいある」', answer: '「多数存在する」' },
                    { original: '「ちゃんとする」', answer: '「適切に行う」' },
                    { original: '「やっぱり」', answer: '「やはり」' },
                    { original: '「すごく大事」', answer: '「非常に重要」' }
                ],
                placeholder: '例）「すごく深刻」→「極めて深刻」',
                feedback: `✅ 語彙の言い換えが完了しました！

【学習したポイント】
✓ 口語表現を書き言葉に変換
✓ より適切で正式な表現を選択
✓ 小論文に適した語彙の使用

良い言い換えの例：
• 「すごく深刻」→「極めて深刻」
• 「いっぱいある」→「多数存在する」
• 「ちゃんとする」→「適切に行う」
• 「やっぱり」→「やはり」
• 「すごく大事」→「非常に重要」

これらの語彙を使って、次のステップで短文を作成してみましょう！`
            },
            {
                stepNumber: 3,
                type: 'short_essay',
                title: 'Step 3: 短文',
                subtitle: '短い文章を書く練習',
                question: '環境問題について、あなたが最も重要だと思うことを50-100字で書いてください。',
                placeholder: '例）環境問題は私たちの生活に直接影響する極めて深刻な課題です。一人ひとりが...',
                feedback: `👍 短文の作成ができました！

【良かった点】
• テーマに沿った内容が書けています
• 適切な語彙が使われています
• 文章の構成が明確です

【アドバイス】
短文では、以下のポイントを意識しましょう：
1. 一文を短くまとめる
2. 主語と述語を明確にする
3. 接続詞を適切に使う
4. 具体例を1つ入れる

次のステップでは、この短文を発展させて本格的な小論文を書いていきます！`
            },
            {
                stepNumber: 4,
                type: 'main_practice',
                title: 'Step 4: 本練習',
                subtitle: '本番の小論文を書く',
                question: `「環境問題について、私たちができること」というテーマで、300-400字の小論文を書いてください。

【構成の例】
導入（50字）：環境問題の現状
本文1（100字）：できることの具体例
本文2（100字）：それが環境に与える影響
結論（50字）：まとめと今後の決意`,
                placeholder: '近年、環境問題は...',
                feedback: `🎯 本練習の小論文が完成しました！

【総合評価】

📝 構成力: ⭐⭐⭐⭐⭐
導入→本文→結論の流れが明確で、読みやすい構成になっています。

📚 語彙力: ⭐⭐⭐⭐⭐
適切な語彙が使われ、書き言葉として適切な表現ができています。

💡 内容の妥当性: ⭐⭐⭐⭐⭐
具体的な例を挙げて説得力のある内容になっています。

✍️ 文法: ⭐⭐⭐⭐⭐
文法的に正確で、誤字脱字もありません。

【具体的なフィードバック】
• 環境問題の現状を簡潔に説明できています
• 私たちができることを具体的に提示できています
• その行動が環境に与える影響を論理的に説明できています
• 結論で未来への決意が述べられています

素晴らしい小論文です！次のステップでは、さらに高度なチャレンジ課題に取り組みましょう！`
            },
            {
                stepNumber: 5,
                type: 'challenge',
                title: 'Step 5: チャレンジ',
                subtitle: '応用問題に挑戦',
                question: `【チャレンジ課題】

以下の反対意見に対して、あなたの考えを100-150字で反論してください。

反対意見：
「環境問題への取り組みは、個人の努力だけでは意味がない。企業や政府が動かなければ解決できない。」`,
                placeholder: 'たしかに企業や政府の役割は重要です。しかし...',
                feedback: `🏆 チャレンジ課題クリア！

【優れた点】
✓ 反対意見を受け止めている
✓ 論理的に反論できている
✓ 個人の役割の重要性を説明できている
✓ 具体例を挙げて説得力を持たせている

【論理展開】
1. 相手の意見を認める（譲歩）
2. しかし、という接続詞で転換
3. 個人の行動の重要性を説明
4. 具体例で補強
5. 結論で自分の主張をまとめる

このような論理展開ができると、説得力のある小論文が書けるようになります！

それでは最後に、今日の学習のまとめを行いましょう。`
            },
            {
                stepNumber: 6,
                type: 'summary',
                title: 'Step 6: まとめ',
                subtitle: '振り返りと総評',
                question: '今日の学習を振り返って、学んだこと・気づいたことを書いてください。',
                placeholder: '今日の学習で、環境問題について...',
                feedback: `🎉 小論文学習コース完了！おめでとうございます！

【今日の学習のまとめ】

📖 **Step 1: 導入**
環境問題についての読み物を読み、テーマを理解しました。

📚 **Step 2: 語彙**
口語表現を書き言葉に変換する練習をしました。
適切な語彙選択の重要性を学びました。

✍️ **Step 3: 短文**
50-100字の短文作成を通じて、簡潔な表現を学びました。

📝 **Step 4: 本練習**
300-400字の本格的な小論文を執筆しました。
構成を意識した文章作成ができました。

🏆 **Step 5: チャレンジ**
反対意見への反論を通じて、論理的思考力を鍛えました。

💭 **Step 6: まとめ**
学習を振り返り、自分の成長を確認しました。

【総合評価】
⭐⭐⭐⭐⭐ 素晴らしい！

あなたは6つのステップを通じて、小論文の基礎から応用まで学習しました。
この経験を活かして、これからも様々なテーマで小論文を書いてみましょう！

【本番システムの特徴】
実際のシステムでは：
• 画像からテーマを自動抽出
• あなたの解答をAIが個別分析
• レベルに応じた最適なフィードバック
• セッション管理で途中から再開可能
• 手書き原稿のOCR対応

継続して学習することで、必ず小論文力が向上します！
頑張ってください！ 📖✨`
            }
        ];

        let currentStep = 0;
        const totalSteps = DEMO_STEPS.length;
        const userAnswers = [];

        // Initialize
        function init() {
            renderProgressBar();
            renderStep();
        }

        // Render progress bar
        function renderProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const labels = ['導入', '語彙', '短文', '本練習', 'チャレンジ', 'まとめ'];
            let html = '';
            
            for (let i = 0; i < totalSteps; i++) {
                const status = i < currentStep ? 'completed' : i === currentStep ? 'active' : 'pending';
                
                html += `
                    <div class="flex items-center ${i === totalSteps - 1 ? '' : 'flex-1'}">
                        <div class="step-dot ${status}">
                            <div class="step-dot-number">${i < currentStep ? '<i class="fas fa-check"></i>' : i + 1}</div>
                            <div class="text-xs mt-1">${labels[i]}</div>
                        </div>
                        ${i < totalSteps - 1 ? `<div class="step-line ${i < currentStep ? 'completed' : ''}"></div>` : ''}
                    </div>
                `;
            }
            
            progressBar.innerHTML = html;
        }

        // Render current step
        function renderStep() {
            const step = DEMO_STEPS[currentStep];
            const stepArea = document.getElementById('stepArea');
            
            let html = `
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">${step.title}</h2>
                            <p class="text-sm text-gray-500">${step.subtitle}</p>
                        </div>
                        <span class="text-sm text-gray-500">ステップ ${step.stepNumber} / ${totalSteps}</span>
                    </div>
            `;
            
            // Show reading content for Step 1
            if (step.showReading) {
                html += `
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                        <h3 class="font-bold text-lg mb-3 text-gray-800">
                            <i class="fas fa-book-open text-blue-600 mr-2"></i>
                            ${DEMO_THEME.title}
                        </h3>
                        <div class="reading-content text-gray-700">
                            ${step.content.split('\n').map(line => `<p class="mb-4">${line}</p>`).join('')}
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="submitStep()" class="bg-green-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-green-700 transition">
                            <i class="fas fa-check mr-2"></i>読んだ
                        </button>
                    </div>
                `;
            } else if (step.type === 'vocabulary') {
                html += `
                    <p class="text-gray-700 mb-6">${step.question}</p>
                    <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-6">
                        <h4 class="font-bold mb-4 text-gray-800">語彙リスト</h4>
                        <div class="space-y-3">
                            ${step.vocabList.map((v, i) => `
                                <div class="flex items-center space-x-3">
                                    <span class="font-bold text-purple-600">${i + 1}.</span>
                                    <span>${v.original}</span>
                                    <span class="text-gray-400">→</span>
                                    <span class="text-gray-400">${v.answer}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <textarea 
                        id="answerInput"
                        class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4"
                        rows="6"
                        placeholder="${step.placeholder}"
                    >${userAnswers[currentStep] || ''}</textarea>
                    <button onclick="submitStep()" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-700 transition">
                        <i class="fas fa-check-circle mr-2"></i>解答する
                    </button>
                `;
            } else {
                html += `
                    <p class="text-gray-700 mb-6 whitespace-pre-line">${step.question}</p>
                    <textarea 
                        id="answerInput"
                        class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4"
                        rows="10"
                        placeholder="${step.placeholder}"
                    >${userAnswers[currentStep] || ''}</textarea>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-sm text-gray-500">
                            <span id="charCount">0</span> 文字
                        </div>
                        ${currentStep === 3 ? '<div class="text-sm text-gray-500">目安: 300-400字</div>' : ''}
                    </div>
                    <button onclick="submitStep()" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-700 transition">
                        <i class="fas fa-check-circle mr-2"></i>解答する
                    </button>
                `;
            }
            
            html += `</div>`;
            stepArea.innerHTML = html;
            
            // Character count
            const textarea = document.getElementById('answerInput');
            if (textarea) {
                const charCount = document.getElementById('charCount');
                textarea.addEventListener('input', function() {
                    if (charCount) charCount.textContent = this.value.length;
                });
                if (charCount) charCount.textContent = textarea.value.length;
            }
            
            // Render navigation
            renderNavigation();
            
            // Hide feedback initially
            document.getElementById('feedbackArea').classList.add('hidden');
        }

        // Render navigation buttons
        function renderNavigation() {
            const navigationArea = document.getElementById('navigationArea');
            let html = '';
            
            // Back button (except first step)
            if (currentStep > 0) {
                html += `
                    <button onclick="goToPreviousStep()" class="flex-1 bg-gray-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-600 transition">
                        <i class="fas fa-arrow-left mr-2"></i>前のステップ
                    </button>
                `;
            }
            
            navigationArea.innerHTML = html;
        }

        // Submit current step
        function submitStep() {
            const textarea = document.getElementById('answerInput');
            const answer = textarea ? textarea.value : 'completed';
            
            // Save answer
            userAnswers[currentStep] = answer;
            
            // Show feedback
            const step = DEMO_STEPS[currentStep];
            const feedbackArea = document.getElementById('feedbackArea');
            const feedbackContent = document.getElementById('feedbackContent');
            
            feedbackContent.innerHTML = `<p class="whitespace-pre-line leading-relaxed">${step.feedback}</p>`;
            feedbackArea.classList.remove('hidden');
            
            // Update navigation to show "Next Step" button
            const navigationArea = document.getElementById('navigationArea');
            let html = '';
            
            if (currentStep > 0) {
                html += `
                    <button onclick="goToPreviousStep()" class="flex-1 bg-gray-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-600 transition">
                        <i class="fas fa-arrow-left mr-2"></i>前のステップ
                    </button>
                `;
            }
            
            if (currentStep < totalSteps - 1) {
                html += `
                    <button onclick="goToNextStep()" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition">
                        次のステップへ
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                `;
            } else {
                html += `
                    <button onclick="restartDemo()" class="flex-1 bg-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-purple-700 transition">
                        <i class="fas fa-redo mr-2"></i>もう一度試す
                    </button>
                `;
            }
            
            navigationArea.innerHTML = html;
            
            // Scroll to feedback
            feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Go to next step
        function goToNextStep() {
            if (currentStep < totalSteps - 1) {
                currentStep++;
                renderProgressBar();
                renderStep();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Go to previous step
        function goToPreviousStep() {
            if (currentStep > 0) {
                currentStep--;
                renderProgressBar();
                renderStep();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Restart demo
        function restartDemo() {
            currentStep = 0;
            userAnswers.length = 0;
            renderProgressBar();
            renderStep();
            document.getElementById('feedbackArea').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
