# AI & プログラミングのKOBEYA - Study Partner System
## システム全機能一覧と紹介

---

## 📋 全機能一覧

### 🎯 メイン学習機能（AI学習パートナー）

#### 1. 画像解析・段階学習システム
- **画像解析機能（GPT-4o Vision）**
  - 手書き・印刷教材の自動認識
  - 問題の複雑さ自動判定
  - 画像クロップ機能（Cropper.js）
  - カメラ撮影・ファイル選択対応

- **動的段階学習生成**
  - 4-7ステップの段階的学習自動生成
  - ステップバイステップの確認問題
  - リアルタイム回答チェック
  - 正誤判定と即時フィードバック

- **類似問題自動生成（5-8問）**
  - 難易度別出題（Easy → Medium → Hard）
  - 混合形式対応（選択問題60% + 記述問題40%）
  - 段階的学習・確認問題は選択肢形式統一
  - 適応的難易度調整

#### 2. AI質問チャット機能
- テキスト・画像両対応の質問受付
- 文部科学省学習指導要領準拠の回答
- 学習コンテキスト考慮の個別サポート
- 別ウィンドウ専用チャット環境
- フローティングAIチャットボタン
- 会話履歴保持（最大50ターン）

#### 3. 学習ログ・分析システム
- 学習セッション自動記録
- 学習時間・正答率自動集計
- 弱点タグ自動抽出
- 数値正規化（全角→半角変換）
- 教材マスターデータによるタグ推定
- 冪等性保証（重複防止機能）

#### 4. 保護者レポート生成
- 週次学習レポート自動生成
- セッション数・学習時間集計
- 平均点・弱点分析（TOP3）
- 次回推奨アクション提案
- JSON形式構造化レポート
- Webhook Secret認証セキュア通信

---

### 📝 小論文講座システム（100%完成）

#### 5. 小論文指導（6ステップ完全実装）

**Step 1: 導入（理解度確認）**
- テーマ別読み物自動生成（GPT-4o）
- 理解度確認質問3問自動生成
- 手書き回答OCR対応
- AI自動添削・フィードバック

**Step 2: 語彙力強化**
- 口語→小論文表現変換練習
- 毎回異なる問題自動生成
- レベル別難易度調整
- 模範解答即時表示

**Step 3: 短文演習（200字）**
- 構成力トレーニング（主張→理由→具体例→結論）
- AI添削システム
- 構造化フィードバック
- 手書き・テキスト入力両対応

**Step 4: 本練習（400-600字）**
- 本格的小論文作成
- 問題自動生成（テーマベース）
- レベル別文字数要件自動調整
- AI総合評価（50-90点スコア）

**Step 5: チャレンジ問題**
- 応用的テーマ出題
- 高難易度問題対応
- 総合力評価

**Step 6: 学習記録カード**
- セッション全体統計自動集計
- 提出本数・平均スコア計算
- 良かった点TOP3抽出
- 改善点・次回目標自動生成
- PDF出力機能

#### 6. 授業形式カスタマイズ
- **総合（55分構成）**: 全ステップ実施
- **語彙力強化中心（25分構成）**: 語彙トレーニング重視
- **短文演習中心（30分構成）**: 短文練習重視
- 授業形式別メッセージ自動調整

#### 7. 問題ライブラリシステム
- AI生成問題の自動蓄積・再利用
- OpenAI APIコスト70-80%削減
- 同一生徒への重複防止
- 品質スコア自動管理（使用回数・平均点ベース）
- 時事問題自動更新（年次論理削除）
- テーマ別問題管理（約10問/テーマ）
- 内容ハッシュによる重複排除

#### 8. 管理者ダッシュボード
- 問題ライブラリ統計表示
- 問題一覧・詳細表示
- フィルタリング機能（テーマ・レベル・品質）
- 有効化/無効化切替
- 時事問題一括削除（メンテナンス機能）
- 使用履歴トラッキング

#### 9. PDF出力機能
- 学習記録カードPDF生成
- A4サイズ印刷最適化
- 統計情報ビジュアル表示
- 指導者サイン欄
- カスタマイズ可能レイアウト

---

### 🎓 英検対策システム（Phase 3-4 本番稼働）

#### 10. 英検問題生成エンジン（5形式対応）

**対応問題形式**:
- ✅ **grammar_fill**: 文法穴埋め問題（4択）
- ✅ **opinion_speech**: 意見スピーチ問題
- ✅ **reading_aloud**: 音読問題（50-80語）
- ✅ **essay**: エッセイ問題（80%品質達成）
- ✅ **long_reading**: 長文読解問題（84%品質達成）

**対応グレード**: 5級、4級、3級、準2級、2級、準1級、1級

#### 11. 語彙レベル検証システム（CEFR準拠）
- 10,000語以上の語彙データベース
- CEFR-J準拠レベル判定（A1-C2）
- 形式別最適温度設定（0.25-0.5）
- 適応的閾値調整
- 動的禁止語学習（VocabularyFailureTracker）
- Few-shot Examples（Good/Bad対比）

#### 12. 著作権検証システム
- 過去問類似度自動チェック
- オリジナリティ保証
- 問題レポート機能

#### 13. トピック管理システム
- 61トピック（5級-1級）
- トピック使用履歴管理
- 形式適性スコア
- 自動トピック選択

#### 14. Blueprint最適化システム
- AIプロンプト最適化
- 形式別プロンプトテンプレート
- 品質保証機能
- 全選択肢語彙解説付き

#### 15. Phase 4 語彙品質改善（実績）
- Essay: 64% → 80% 品質向上
- Long Reading: 69% → 84% 品質向上
- 動的禁止語学習システム導入
- Few-shot Examples実装
- 形式別最適パラメータ調整

---

### 💾 データベース機能（Cloudflare D1）

#### 16. 学習データ管理
- **logs**: 学習ログデータ
- **students**: 生徒マスターデータ
- **master_materials**: 教材マスターデータ
- **learning_sessions**: セッション管理

#### 17. 小論文システムDB
- **essay_sessions**: 小論文セッション管理
- **essay_submissions**: 小論文提出記録
- **essay_learning_cards**: 学習記録カード
- **essay_vocabulary**: 語彙学習履歴
- **essay_problem_library**: 問題ライブラリ
- **essay_problem_usage**: 問題使用履歴

#### 18. 英検システムDB
- **eiken_generated_questions**: 生成問題（10,000語）
- **eiken_vocabulary_lexicon**: 語彙データベース
- **eiken_topic_areas**: トピック管理（61トピック）
- **eiken_topic_question_type_suitability**: 形式適性
- **eiken_topic_usage_history**: 使用履歴
- **eiken_problem_reports**: 問題レポート

#### 19. 語彙ノートシステムDB（Phase 4A）
- **vocabulary_notebook_entries**: 語彙ノートエントリ
- **vocabulary_review_history**: 復習履歴
- **vocabulary_master**: 語彙マスターデータ

---

### 🔒 セキュリティ・認証機能

#### 20. 認証システム
- APP_KEY + 生徒ID認証
- Webhook Secret認証（ログAPI）
- セッション管理
- 環境変数管理（OPENAI_API_KEY等）

---

### 🎨 ユーザーインターフェース

#### 21. メイン学習画面
- レスポンシブデザイン（モバイル最適化）
- ログイン認証画面
- AIに質問ボタン
- カメラ撮影機能
- ファイル選択機能
- 画像クロップ機能
- アップロード進行表示
- 段階学習インターフェース
- 類似問題インターフェース

#### 22. 小論文講座UI
- 6ステップビジュアル進行表示
- OCR処理インターフェース
- AI添削結果表示
- 学習記録カード表示
- PDF出力ボタン
- クイックアクションボタン
- 手書き・テキスト入力切替

#### 23. 英検対策UI
- 練習画面（/eiken/practice）
- 問題選択インターフェース
- 語彙解説モーダル
- 進捗表示
- スコア表示

#### 24. 管理者UI
- 管理者ダッシュボード（/admin）
- 小論文問題ライブラリ管理（/essay-admin）
- 統計カード表示
- 問題一覧テーブル
- フィルタリングUI
- 詳細モーダル

#### 25. AI質問チャット画面
- 別ウィンドウチャット（/ai-chat/:sessionId）
- 別ウィンドウチャットV2（/ai-chat-v2/:sessionId）
- フローティングチャットボタン
- 画像アップロード対応
- 会話履歴表示

---

### 🔧 API エンドポイント（全39エンドポイント）

#### 学習システムAPI
1. `GET /api/health` - システムヘルスチェック
2. `POST /api/login` - 生徒認証
3. `POST /api/analyze-and-learn` - 画像解析・学習開始
4. `POST /api/step/check` - 段階学習確認
5. `POST /api/confirmation/check` - 確認問題チェック
6. `POST /api/similar/check` - 類似問題チェック
7. `POST /api/ai/chat` - AI質問チャット

#### ログ・レポートAPI
8. `GET /api/logs/health` - ログシステムヘルスチェック
9. `POST /api/logs` - 学習ログ記録
10. `POST /api/reports/weekly` - 週次レポート生成

#### 小論文講座API
11. `POST /api/essay/init-session` - セッション初期化
12. `POST /api/essay/upload-image` - 画像アップロード
13. `POST /api/essay/ocr` - OCR処理
14. `POST /api/essay/feedback` - AI添削
15. `POST /api/essay/chat` - チャット
16. `POST /api/essay/generate-pdf` - PDF生成
17. `GET /essay-coaching` - 小論文講座メイン
18. `GET /essay-coaching/session/:sessionId` - セッション復元

#### 小論文管理API
19. `GET /essay-admin` - 管理ダッシュボード
20. `GET /api/essay-admin/statistics` - 統計取得
21. `GET /api/essay-admin/problems` - 問題一覧
22. `GET /api/essay-admin/problems/:id` - 問題詳細
23. `POST /api/essay-admin/problems/:id/toggle` - 有効化切替
24. `POST /api/essay-admin/cleanup-events` - 時事問題削除

#### 英検対策API
25. `POST /api/eiken/questions/generate` - 問題生成
26. `GET /api/eiken/questions/list` - 問題一覧
27. `GET /api/eiken/questions/:id` - 問題詳細
28. `POST /api/eiken/questions/analyze` - 問題分析
29. `POST /api/eiken/questions/translate` - 翻訳
30. `GET /api/eiken/vocabulary/search` - 語彙検索
31. `GET /api/eiken/topics` - トピック一覧
32. `POST /api/eiken/topics/:id/use` - トピック使用記録
33. `GET /api/eiken/blueprints` - Blueprint一覧

#### フラッシュカードAPI
34. `GET /flashcard` - フラッシュカード
35. `POST /api/flashcard/*` - フラッシュカード操作

#### 語彙ノートAPI（Phase 4A）
36. `POST /api/vocabulary/save` - 語彙保存
37. `GET /api/vocabulary/list` - 語彙一覧
38. `POST /api/vocabulary/review` - 復習記録
39. `GET /vocabulary-demo` - 語彙デモ画面

---

### 📱 メインページ・機能画面

#### 学習画面
- `/` - メイン学習画面（画像解析）
- `/study-partner` - 学習パートナー
- `/study-partner-simple` - シンプル版
- `/dashboard` - ダッシュボード

#### 小論文
- `/essay-coaching` - 小論文講座
- `/essay-admin` - 小論文管理

#### 英検
- `/eiken/practice` - 英検練習

#### その他
- `/flashcard` - フラッシュカード
- `/vocabulary-demo` - 語彙ノートデモ
- `/international-student/*` - インター生向け（準備中）

---

### 🤖 AI統合機能

#### 26. OpenAI GPT-4o 統合
- 画像解析（GPT-4o Vision）
- 段階学習生成
- 類似問題生成
- チャット応答生成
- 小論文添削
- 問題文生成
- 読み物生成
- 語彙問題生成

#### 27. AI品質管理
- レスポンス検証
- フォールバック機能
- エラーハンドリング
- 温度パラメータ最適化（0.25-0.7）
- トークン数管理
- コスト最適化

---

### 🎓 教育方針フレームワーク

#### 28. 文部科学省学習指導要領準拠
- 主体的・対話的で深い学び
- 3つの観点評価（知識・技能、思考・判断・表現、学習態度）
- 教科横断的能力育成
- 個別最適化支援

#### 29. AI指導プロトコル
- 中学生適応コミュニケーション
- ソクラテス式問答法
- スキャフォールディング
- エラーを学習機会に変換

---

### 🛠️ 開発・運用機能

#### 30. デプロイメント
- Cloudflare Pages自動デプロイ
- GitHub連携
- 本番・開発環境分離
- 環境変数管理

#### 31. モニタリング
- システムヘルスチェック
- ログ収集システム
- エラートラッキング
- パフォーマンス監視

#### 32. データマイグレーション
- 34個のマイグレーションファイル
- 自動スキーマ同期
- バージョン管理

---

## 🌟 システム紹介文

**AI & プログラミングのKOBEYA Study Partner System**は、バンコク在住の日本人小中学生向けに開発された、次世代AI学習パートナーシステムです。

OpenAI GPT-4oの先進的な画像認識・自然言語処理技術と、Cloudflare Workers/D1による高速・スケーラブルなインフラを組み合わせ、一人ひとりの学習ニーズに最適化された個別指導を実現します。

### 🎯 3つのコア機能

#### 1. **AI学習パートナー（メインシステム）**
手書き・印刷教材を瞬時に解析し、問題の難易度に応じて4-7ステップの段階的学習を自動生成。さらに、理解度に応じた5-8問の類似問題を難易度別に出題し、確実な定着を図ります。文部科学省学習指導要領に準拠したAIチャット機能により、24時間いつでも質の高い学習サポートを提供します。

#### 2. **小論文講座システム（100%完成）**
高校入試・専門学校入試・大学入試対策に完全対応した、6ステップの体系的小論文指導システム。AIによる読み物生成、語彙力強化、短文演習、本格小論文作成、そして学習記録カードの自動生成まで、すべてをワンストップで実現。問題ライブラリシステムにより、AI生成コストを70-80%削減しながら、高品質な問題を継続的に提供します。管理者ダッシュボードで問題の品質管理も容易に行えます。

#### 3. **英検対策システム（Phase 4完成）**
5級から1級まで全グレードに対応した、5形式の英検問題自動生成エンジン。CEFR準拠の10,000語以上の語彙データベースと、動的禁止語学習システムにより、各級の語彙レベルに適した高品質な問題を生成。Essay問題の品質は64%から80%へ、Long Reading問題は69%から84%へと大幅に向上しました。

### 📊 学習効果の可視化

学習セッションを自動記録し、学習時間・正答率・弱点分析を集計。保護者向けには週次レポートを自動生成し、お子様の学習状況と次回への推奨アクションを明確に提示します。小論文講座では、セッション全体の統計を自動集計し、PDF形式の学習記録カードを出力可能です。

### 🔒 安全性とプライバシー

Cloudflare Pagesの堅牢なセキュリティインフラ上に構築され、Webhook Secret認証、環境変数管理による安全なデータ保護を実現。すべての学習データはCloudflare D1データベースに暗号化保存されます。

### 🌏 バンコクの日本人家庭に最適化

タイ・バンコクの教育環境に特化し、日本のカリキュラムに準拠しながら、海外在住ならではの学習ニーズに対応。フジスーパー2号店2階の教室で、対面指導とAI学習を組み合わせたハイブリッド学習を提供します。

### 🚀 技術的特徴

- **フレームワーク**: Hono (Cloudflare Workers)
- **AI**: OpenAI GPT-4o, GPT-4o Vision
- **データベース**: Cloudflare D1 (SQLite)
- **デプロイ**: Cloudflare Pages（自動デプロイ）
- **UI**: TypeScript/JSX + Tailwind CSS + Vanilla JavaScript

### 📈 実績と品質

- **総コード行数**: 12,000行以上
- **データベーステーブル**: 18テーブル
- **APIエンドポイント**: 39エンドポイント
- **マイグレーション**: 34ファイル
- **語彙データベース**: 10,000語以上
- **英検トピック**: 61トピック（5級-1級）
- **小論文問題ライブラリ**: テーマ別約10問/テーマ
- **AI生成コスト削減**: 70-80%
- **英検問題品質**: Essay 80%, Long Reading 84%達成

小学1年生から中学3年生まで、一人ひとりの「わかった！」を大切にする、AI時代の新しい学習パートナーです。

---

**本番環境URL**: https://kobeyabkk-studypartner.pages.dev/

**問い合わせ**: 
- 教室: AI & プログラミングのKOBEYA
- 所在地: フジスーパー2号店2階
- 電話: 066-123-4567
- LINE: @kobeya
- メール: info@kobeya-programming.com

**開講時間**: 平日 16:00-20:00 / 土日 9:00-17:00 / 定休日なし（祝日は要確認）

---

**Last Updated**: 2025年12月6日  
**Version**: 3.1.0  
**Status**: ✅ 全機能本番稼働中
