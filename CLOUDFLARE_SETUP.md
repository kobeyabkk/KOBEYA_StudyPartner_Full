# Cloudflare Pages è¨­å®šæ‰‹é †

## ğŸš¨ é‡è¦ï¼šä»¥ä¸‹ã®è¨­å®šã‚’Cloudflare Dashboardã§è¡Œã£ã¦ãã ã•ã„

### 1. D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®è¨­å®š

1. **Cloudflare Dashboard**ã‚’é–‹ã: https://dash.cloudflare.com
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ **Workers & Pages** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **kobeyabkk-studypartner** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯
4. **Settings** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
5. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ **Functions** ã‚’ã‚¯ãƒªãƒƒã‚¯
6. **D1 database bindings** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

#### Productionç’°å¢ƒã®è¨­å®š
7. **Add binding** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
8. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **Variable name**: `DB`
   - **D1 database**: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ `kobeya-logs-db` ã‚’é¸æŠ
9. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### Previewç’°å¢ƒã®è¨­å®š
10. åŒã˜ãƒšãƒ¼ã‚¸ã§ **Preview** ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
11. å†åº¦ **Add binding** ã‚’ã‚¯ãƒªãƒƒã‚¯
12. åŒã˜å†…å®¹ã‚’å…¥åŠ›ï¼š
    - **Variable name**: `DB`
    - **D1 database**: `kobeya-logs-db`
13. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

---

### 2. OpenAI APIã‚­ãƒ¼ã®è¨­å®š

1. åŒã˜ **Settings** ãƒšãƒ¼ã‚¸ã§ã€å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ **Environment variables** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### Productionç’°å¢ƒã®è¨­å®š
2. **Add variables** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆProductionã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
3. ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   - **Variable name**: `OPENAI_API_KEY`
   - **Value**: `ã‚ãªãŸã®OpenAI APIã‚­ãƒ¼` (sk-ã‹ã‚‰å§‹ã¾ã‚‹æ–‡å­—åˆ—)
   - **Type**: `Encrypted` ã‚’é¸æŠï¼ˆæ¨å¥¨ï¼‰
4. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### Previewç’°å¢ƒã®è¨­å®š
5. **Preview** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚åŒã˜æ‰‹é †ã‚’ç¹°ã‚Šè¿”ã—
6. åŒã˜å†…å®¹ã‚’å…¥åŠ›ï¼š
   - **Variable name**: `OPENAI_API_KEY`
   - **Value**: `åŒã˜OpenAI APIã‚­ãƒ¼`
   - **Type**: `Encrypted`
7. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

---

### 3. å†ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆè¨­å®šåæ˜ ã®ãŸã‚ï¼‰

è¨­å®šå¤‰æ›´å¾Œã€å†ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦ã§ã™ï¼š

#### æ–¹æ³•A: Cloudflare Dashboardã‹ã‚‰
1. **Deployments** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆcommit `1286377`ï¼‰ã‚’è¦‹ã¤ã‘ã‚‹
3. å³å´ã® **ï¸™** (3ç‚¹ãƒ¡ãƒ‹ãƒ¥ãƒ¼) ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **Retry deployment** ã‚’ã‚¯ãƒªãƒƒã‚¯

#### æ–¹æ³•B: ç©ºã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
```bash
cd /home/user/StudyPartner_Full_Main
git commit --allow-empty -m "Trigger redeploy after Cloudflare settings"
git push origin dev
```

---

### 4. å‹•ä½œç¢ºèª

å†ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œï¼ˆ2-3åˆ†ï¼‰ï¼š

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§é–‹ã
2. https://dev.kobeyabkk-studypartner.pages.dev/essay-coaching ã«ã‚¢ã‚¯ã‚»ã‚¹
3. æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
4. ãƒ†ãƒ¼ãƒã€Œçœ‹è­·ã€ã‚’å…¥åŠ›
5. å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã€Œè§£èª¬é‡è¦–ã€ã‚’é¸æŠ
6. ã€ŒOKã€ã‚’é€ä¿¡

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- 500ã€œ800æ–‡å­—ã®è©³ç´°ãªèª­ã¿ç‰©ãŒç”Ÿæˆã•ã‚Œã‚‹
- ã€Œçœ‹è­·ã¯ã€ç—…æ°—ã‚„ã‘ãŒã‚’ã—ãŸäººã€…ã®å¥åº·å›å¾©ã‚’æ”¯æ´ã—...ã€ã®ã‚ˆã†ãªå…·ä½“çš„ãªå†…å®¹

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Database not available"
â†’ D1ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸Šè¨˜ã®æ‰‹é †1ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### ä¾ç„¶ã¨ã—ã¦æ±ç”¨ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
â†’ OpenAI APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸Šè¨˜ã®æ‰‹é †2ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ãã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š
- `ğŸ¤– Calling OpenAI API...` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹
- `âŒ CRITICAL: OPENAI_API_KEY is not configured!` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹
- `ğŸ“¡ OpenAI API response status: 200` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹

---

## ğŸ“¸ è¨­å®šç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆå‚è€ƒï¼‰

### D1 database bindings ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ D1 database bindings                        â”‚
â”‚                                             â”‚
â”‚ Production                                  â”‚
â”‚ Variable name: DB                           â”‚
â”‚ D1 database: kobeya-logs-db                 â”‚
â”‚ [Remove]                                    â”‚
â”‚                                             â”‚
â”‚ Preview                                     â”‚
â”‚ Variable name: DB                           â”‚
â”‚ D1 database: kobeya-logs-db                 â”‚
â”‚ [Remove]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Environment variables ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Environment variables                       â”‚
â”‚                                             â”‚
â”‚ Production                                  â”‚
â”‚ OPENAI_API_KEY: *************** (Encrypted)â”‚
â”‚ [Edit] [Remove]                             â”‚
â”‚                                             â”‚
â”‚ Preview                                     â”‚
â”‚ OPENAI_API_KEY: *************** (Encrypted)â”‚
â”‚ [Edit] [Remove]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… è¨­å®šå®Œäº†å¾Œã®ç¢ºèª

ã™ã¹ã¦ã®è¨­å®šãŒå®Œäº†ã—ã€å†ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã—ãŸã‚‰ï¼š

1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
   ```bash
   curl -X POST "https://dev.kobeyabkk-studypartner.pages.dev/api/admin/migrate-db"
   ```
   
2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼š
   ```bash
   curl "https://dev.kobeyabkk-studypartner.pages.dev/api/health"
   ```

3. æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ãƒ†ã‚¹ãƒˆ

---

**é‡è¦**: ã“ã®è¨­å®šã¯ä¸€åº¦ã ã‘è¡Œãˆã°ã€ä»¥é™ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã‚‚æœ‰åŠ¹ã§ã™ã€‚
