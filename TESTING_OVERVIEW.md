# 🧪 テスト実施ガイド - 概要（初心者向け）

## 📋 目次

1. [テストの目的](#テストの目的)
2. [テストの順番](#テストの順番)
3. [必要な準備](#必要な準備)
4. [各テストの所要時間](#各テストの所要時間)
5. [クイックスタートガイド](#クイックスタートガイド)
6. [トラブルシューティング](#トラブルシューティング)

---

## 🎯 テストの目的

このテストスイートは、**StudyPartner Full (D1統合版)** のセッション永続化機能が正しく動作することを確認するためのものです。

### 確認する主な機能

1. ✅ **セッション永続化**: Cloudflare Worker再起動後もデータが失われない
2. ✅ **OCR結果の保存**: 手書き文字認識結果がD1データベースに保存される
3. ✅ **OCR修正の保存**: ユーザーが修正した内容が永続化される
4. ✅ **AIフィードバックの保存**: 添削結果がD1データベースに保存される
5. ✅ **複数回の操作履歴**: 修正・添削の履歴がすべて保持される

---

## 📝 テストの順番

以下の順番で実施してください：

### 🟢 **Phase 1: 基礎テスト（必須）**

#### 1️⃣ デプロイ完了確認（5分）
- Cloudflare Pagesのデプロイが完了しているか確認
- URLにアクセスできるか確認

#### 2️⃣ セッション永続化テスト（15分）
- **ドキュメント**: `TEST_SESSION_PERSISTENCE.md`
- **内容**: 画像アップロード → OCR処理 → Worker再起動 → データ復元
- **重要度**: ⭐⭐⭐⭐⭐（最重要）

---

### 🟡 **Phase 2: 機能テスト（推奨）**

#### 3️⃣ OCR修正機能テスト（10分）
- **ドキュメント**: `TEST_OCR_CORRECTION.md`
- **内容**: OCRテキスト修正 → 保存 → Worker再起動 → 修正内容の保持
- **重要度**: ⭐⭐⭐⭐

#### 4️⃣ AIフィードバック永続化テスト（15分）
- **ドキュメント**: `TEST_AI_FEEDBACK_PERSISTENCE.md`
- **内容**: AI添削実行 → 保存 → Worker再起動 → フィードバック保持
- **重要度**: ⭐⭐⭐⭐

---

### 🔵 **Phase 3: 統合テスト（オプション）**

#### 5️⃣ 完全ワークフローテスト（30分）
- すべての機能を連続して実行
- 複数回の修正・添削を実施
- 長時間経過後（24時間後）の復元テスト

---

## 🛠️ 必要な準備

### ✅ チェックリスト

- [ ] Cloudflare Pagesのデプロイが完了している
- [ ] D1データベース `kobeya-logs-db` が作成されている
- [ ] `wrangler.toml` にD1バインディングが設定されている
- [ ] テスト用の手書き画像を準備（小論文・レポートなど）
- [ ] ブラウザ（Chrome, Firefox, Safariなど）
- [ ] メモ帳またはテキストエディタ（結果記録用）

### 📱 推奨ツール

- **ブラウザ開発者ツール**（F12キー）: エラー確認用
- **Cloudflare Dashboard**: D1データベースの直接確認用
- **スクリーンショットツール**: 結果の記録用

---

## ⏱️ 各テストの所要時間

| テスト名 | 所要時間 | 難易度 |
|---------|---------|--------|
| デプロイ確認 | 5分 | ⭐ (簡単) |
| セッション永続化 | 15分 | ⭐⭐ (普通) |
| OCR修正機能 | 10分 | ⭐⭐ (普通) |
| AIフィードバック | 15分 | ⭐⭐⭐ (やや難) |
| 完全ワークフロー | 30分 | ⭐⭐⭐⭐ (難) |

**合計所要時間**: 約 1時間15分（Phase 1〜3すべて実施の場合）

---

## 🚀 クイックスタートガイド

### 最小限のテスト（Phase 1のみ）

時間がない場合は、以下の手順だけでも実施してください：

#### Step 1: デプロイ確認（2分）
```
1. ブラウザで https://kobeyabkk-studypartner.pages.dev を開く
2. 「小論文添削コーチ」セクションが表示されることを確認
3. 「セッション初期化」ボタンをクリック
4. URLに ?session=xxxxx が追加されることを確認
```

#### Step 2: 基本機能確認（5分）
```
1. 「画像をアップロード」で手書き画像を選択
2. 画像プレビューが表示されることを確認
3. 「OCR処理を実行」ボタンをクリック
4. OCRテキストが表示されることを確認
```

#### Step 3: D1保存確認（3分）
```
1. Cloudflare Dashboard → D1 → kobeya-logs-db
2. Console タブで以下を実行:
   SELECT * FROM essay_sessions ORDER BY updated_at DESC LIMIT 1;
3. 自分のセッションデータが表示されることを確認
```

#### Step 4: 復元確認（5分）
```
1. ブラウザのタブを閉じる
2. 5分待つ
3. 保存しておいたセッションID付きURLを開く
4. 画像とOCR結果が復元されることを確認
```

✅ **これだけでも基本的な永続化機能は確認できます！**

---

## 🐛 トラブルシューティング

### よくある問題と解決方法

#### 問題1: 「セッションが見つかりません」エラー
**解決策**:
1. URLに `?session=xxxxx` が含まれているか確認
2. Cloudflare Pagesのデプロイが完了しているか確認
3. D1バインディングが設定されているか確認

#### 問題2: 画像がアップロードできない
**解決策**:
1. 画像ファイルサイズが5MB以下か確認
2. 画像形式がJPG/PNG/HEICか確認
3. ブラウザの開発者ツール（F12）でエラーを確認

#### 問題3: OCR処理が失敗する
**解決策**:
1. OpenAI APIキーが設定されているか確認（Cloudflare Pages環境変数）
2. 画像が鮮明か確認（ぼやけていないか）
3. ネットワークタブで `/api/essay/ocr` リクエストを確認

#### 問題4: Worker再起動後にデータが消える
**解決策**:
1. D1データベースにデータが保存されているか確認:
   ```sql
   SELECT * FROM essay_sessions WHERE session_id = 'あなたのセッションID';
   ```
2. `wrangler.toml` の `binding = "DB"` が正しいか確認
3. Cloudflare Pagesを再デプロイ

---

## 📊 テスト結果の報告

テスト完了後、以下の情報を記録してください：

### テスト結果サマリー

```
【Phase 1: 基礎テスト】
✅ / ❌  デプロイ確認
✅ / ❌  セッション永続化

【Phase 2: 機能テスト】
✅ / ❌  OCR修正機能
✅ / ❌  AIフィードバック永続化

【Phase 3: 統合テスト】
✅ / ❌  完全ワークフロー

【問題点】
- （あれば記載）

【コメント】
- （気づいた点や改善提案など）
```

---

## 🔗 関連ドキュメント

- `TEST_SESSION_PERSISTENCE.md` - セッション永続化の詳細テスト手順
- `TEST_OCR_CORRECTION.md` - OCR修正機能の詳細テスト手順
- `TEST_AI_FEEDBACK_PERSISTENCE.md` - AIフィードバックの詳細テスト手順
- `D1_MIGRATION_INSTRUCTIONS.md` - D1データベースのセットアップ手順

---

## 📞 サポート

問題が解決しない場合、以下の情報を添えて質問してください：

1. **実施したテストフェーズ**（Phase 1, 2, 3のどれか）
2. **失敗したステップ**（具体的なステップ番号）
3. **エラーメッセージのスクリーンショット**
4. **ブラウザの開発者ツール Console の内容**（F12キーで開く）
5. **D1データベースのクエリ結果**
6. **セッションID**

---

**作成日**: 2025-10-29  
**対象バージョン**: StudyPartner Full v1.0 (D1統合版)  
**最終更新**: 2025-10-29

---

## 🎉 テスト完了後

すべてのテストに合格した場合、おめでとうございます！🎊

この小論文添削システムは以下の機能を持つようになりました：

- ✅ セッションデータの永続化
- ✅ Worker再起動後のデータ復元
- ✅ OCR結果の保存と修正
- ✅ AIフィードバックの履歴保持
- ✅ 複数デバイスからのアクセス（同じセッションIDで）

**本番運用開始OK！** 🚀
